services:
  hard-shell:
    build: .
    image: tweek/hard-shell:latest
    ports:
      - "127.0.0.1:${OPENCLAW_GATEWAY_PORT:-18789}:18789"  # Gateway — localhost only
    volumes:
      - ./data/openclaw:/home/node/.openclaw
      - ./data/tweek:/home/node/.tweek
      - ./data/workspace:/home/node/workspace
      - ./data/logs:/home/node/logs
    environment:
      - TWEEK_PRESET=${TWEEK_PRESET:-cautious}
      - OPENCLAW_GATEWAY_PORT=18789
      - TWEEK_SCANNER_PORT=9878
      - OPENCLAW_GATEWAY_TOKEN=${OPENCLAW_GATEWAY_TOKEN:-}
      # LLM API keys — only the one you configured will be non-empty
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - GOOGLE_API_KEY=${GOOGLE_API_KEY:-}
      - GEMINI_API_KEY=${GOOGLE_API_KEY:-}
      - XAI_API_KEY=${XAI_API_KEY:-}
      - OPENAI_BASE_URL=${OPENAI_BASE_URL:-}
      - OPENCLAW_BIND_MODE=${OPENCLAW_BIND_MODE:-}
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    read_only: true
    tmpfs:
      - /tmp:size=100M
      - /home/node/.cache:size=200M,uid=1000,gid=1000
    mem_limit: 2g
    cpus: 2.0
    pids_limit: 256
    restart: unless-stopped
